<!doctype html>
<html lang="ur">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Geo - ENT-TV Dramas with YouTube Player</title>
    <style>
        :root {
            --primary: #8B0000;
            --secondary: #D4AF37;
            --golden: #FFD700;
            --dark-golden: #DAA520;
            --dark: #121212;
            --light: #f5f5f5;
            --gray: #2a2a2a;
            --transition: all 0.3s ease;
            --pink: #ff416c;
            --neon-blue: #00f3ff;
            --neon-purple: #bc00ff;
            --neon-red: #ff0000;
            --header-height: 220px;
            --player-fixed-height: 270px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--dark);
            color: var(--light);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Drama Grid Styles */
        .drama-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 25px;
            padding: 20px 0;
        }

        /* DRAMA CARD STYLES */
        .drama-card {
            background: linear-gradient(145deg, #1a1a1a, #2d2d2d);
            border-radius: 15px;
            overflow: hidden;
            transition: var(--transition);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            cursor: pointer;
            position: relative;
            border: 1px solid #333;
            height: 300px;
            display: flex;
            flex-direction: row;
            align-items: center;
            padding: 10px;
            gap: 15px;
        }

        .drama-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
            border: 1px solid var(--pink);
            background: linear-gradient(145deg, #222222, #333333);
        }

        .drama-card.active {
            border: none;
            background: linear-gradient(45deg, var(--pink), var(--neon-blue), var(--neon-purple), var(--pink));
            background-size: 200%;
            animation: neonFlow 3s infinite;
        }

        @keyframes neonFlow { 
            0% { background-position: 0% 50%; } 
            50% { background-position: 100% 50%; } 
            100% { background-position: 0% 50%; } 
        }

        /* Drama Image Container */
        .drama-image-container {
            position: relative;
            overflow: hidden;
            height: 270px;
            width: 100px;
            min-width: 100px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #000;
            flex-shrink: 0;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .drama-image {
            width: 100%;
            height: 85%;
            object-fit: cover;
            object-position: center;
            transition: var(--transition);
        }

        .drama-card:hover .drama-image {
            transform: scale(1.05);
        }

        .image-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(139, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: var(--transition);
            border-radius: 10px;
        }

        .drama-card:hover .image-overlay {
            opacity: 1;
        }

        .watch-text {
            color: var(--light);
            font-weight: bold;
            font-size: 0.8rem;
            text-align: center;
            padding: 5px 10px;
            border: 2px solid var(--secondary);
            border-radius: 5px;
            background: rgba(0, 0, 0, 0.7);
        }

        .drama-info {
            flex: 1;
            padding: 5px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .drama-title {
            color: var(--light);
            font-size: 0.8rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .drama-year {
            color: var(--secondary);
            font-size: 0.85rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        /* Main Content Area */
        .main-content {
            margin-top: 20px;
            position: relative;
        }

        /* EPISODES GRID - ONLY BUTTONS, NO CONTAINER */
        .episodes-grid {
            display: flex;
            flex-direction: column;
            gap: 15px;
            padding: 20px 0;
            margin-top: 20px;
        }

        /* ÿß€åŸæ€å ÿ≥Ÿà⁄à ÿ®ŸπŸÜÿ≤ - GOLDEN BY DEFAULT */
        .episode-button {
            width: 100%;
            padding: 20px 25px;
            background: linear-gradient(145deg, #FFD700, #DAA520);
            color: #000;
            border: 2px solid #B8860B;
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(218, 165, 32, 0.3);
            transition: all 0.3s ease;
            min-height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
            word-break: break-word;
            position: relative;
            overflow: hidden;
            text-shadow: 0 1px 0 rgba(255, 255, 255, 0.5);
        }

        .episode-button:hover {
            background: linear-gradient(145deg, #FFC800, #C69500);
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(218, 165, 32, 0.5);
            border-color: #A67C00;
        }

        .episode-button.active {
            background: linear-gradient(45deg, var(--primary), var(--pink));
            border: 2px solid var(--secondary);
            color: #fff;
            box-shadow: 0 0 25px rgba(139, 0, 0, 0.6);
            position: relative;
            padding-left: 50px;
            text-shadow: none;
        }

        .episode-button.active::before {
            content: "‚ñ∂";
            position: absolute;
            left: 20px;
            font-size: 18px;
            color: var(--secondary);
        }

        .episode-button.active::after {
            content: "";
            position: absolute;
            right: 20px;
            width: 12px;
            height: 12px;
            background: var(--secondary);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.7; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* YOUTUBE PLAYER STYLES - FIXED AT TOP */
        .player-box {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: var(--player-fixed-height);
            background: #000;
            z-index: 1000;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.8);
        }

        .player-content { 
            width: 100%; 
            height: 280px; 
            position: relative; 
            overflow: hidden; 
        }

        /* Main content margin when player is visible */
        body.player-open .main-content {
            margin-top: calc(var(--player-fixed-height) + 20px);
        }

        /* DRAMA IMAGE IN PLAYER */
.drama-player-image {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center;
    z-index: 5;
    transition: opacity 0.5s ease;
    background-color: #000;
}

/* Center drama image in player - ÿ®ÿ∫€åÿ± ÿßÿ∂ÿßŸÅ€å ÿ≥ÿßÿ¶ÿ≤ ⁄©€í */
.drama-player-image.centered {
    max-width: 100%;
    max-height: 90%;
    top: -25;
    left: 0;
    transform: none;
    width: 100%;
    height: 100%;
    object-fit: contain !important;
}

.drama-player-image.hidden {
    opacity: 0;
    pointer-events: none;
}





        /* NEON LOADER - CENTERED BETWEEN SKIP BUTTONS */
        #bufferingScreen {
            position: absolute; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%;
            background: black;
            z-index: 10;
            display: none; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center;
        }

        .neon-loader {
            width: 60px; 
            height: 60px;
            border: 5px solid transparent; 
            border-top: 5px solid var(--pink);
            border-bottom: 5px solid var(--neon-blue);
            border-radius: 50%; 
            animation: spinNeon 1s linear infinite;
            box-shadow: 0 0 20px rgba(255, 65, 108, 0.5);
        }

        .loading-text {
            margin-top: 15px;
            color: var(--neon-blue);
            font-size: 18px;
            font-weight: bold;
            text-shadow: 0 0 10px var(--neon-blue);
            animation: textGlow 2s infinite alternate;
        }

        @keyframes spinNeon { 
            0% { 
                transform: rotate(0deg); 
                border-top-color: var(--pink);
                border-bottom-color: var(--neon-blue);
            }
            50% { 
                border-top-color: var(--neon-blue);
                border-bottom-color: var(--neon-purple);
            }
            100% { 
                transform: rotate(360deg); 
                border-top-color: var(--pink);
                border-bottom-color: var(--neon-blue);
            }
        }

        @keyframes textGlow {
            0% { 
                color: var(--neon-blue);
                text-shadow: 0 0 5px var(--neon-blue);
            }
            100% { 
                color: var(--neon-purple);
                text-shadow: 0 0 15px var(--neon-purple);
            }
        }

        /* CENTER CONTROLS */
        .center-controls {
            position: absolute; 
            top: 40%; 
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex !important;
            gap: 120px !important;
            z-index: 160; 
            opacity: 1;
            transition: opacity 0.3s ease !important;
        }

        .player-content.show-ui .center-controls { 
            opacity: 1; 
            pointer-events: auto; 
        }

        .player-content.hide-controls .center-controls {
            opacity: 0 !important;
            pointer-events: none !important;
        }

        .skip-btn {
            background: rgba(0,0,0,0.7); 
            border: 2px solid var(--neon-blue);
            color: white; 
            width: 60px; 
            height: 60px; 
            border-radius: 50%;
            cursor: pointer; 
            display: flex; 
            flex-direction: column;
            align-items: center; 
            justify-content: center; 
            font-size: 12px;
            box-shadow: 0 0 15px rgba(0, 243, 255, 0.5);
            transition: all 0.3s ease;
        }

        .skip-btn:hover {
            background: rgba(0,0,0,0.9);
            border-color: var(--neon-purple);
            box-shadow: 0 0 25px rgba(0, 243, 255, 0.8);
            transform: scale(1.1);
        }

        .skip-btn span {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .yt-iframe-wrapper {
            position: absolute; 
            top: -50;
            left: 0; 
            width: 100%; 
            height: 100%; 
            z-index: 1; 
            opacity: 0; 
            transition: 0.5s;
        }

        .yt-iframe-wrapper.active { 
            opacity: 1; 
        }

        #youtube-player { 
            width: 100%; 
            height: 100%; 
            border: none; 
        }

        /* UI CONTROLS */
        .bottom-ui { 
            position: absolute; 
            bottom: 52px; 
            left: 0; 
            right: 0;
            background: black; 
            padding: 10px 15px; 
            z-index: 150; 
            opacity: 1;
            transition: opacity 0.3s ease;
        }

        .player-content.show-ui .bottom-ui { 
            opacity: 1; 
            pointer-events: auto;
        }

        .player-content.hide-controls .bottom-ui {
            opacity: 0 !important;
            pointer-events: none !important;
        }

        .p-bar { 
            width: 100%; 
            height: 5px; 
            background: rgba(255,255,255,0.2); 
            cursor: pointer; 
            border-radius: 5px; 
            margin-bottom: 8px; 
        }

        .p-fill { 
            height: 100%; 
            background: var(--pink); 
            width: 0%; 
            box-shadow: 0 0 8px var(--pink); 
        }

        /* PLAYER CLOSE BUTTON - REMOVED */
        .close-player-btn {
            display: none !important;
        }

        /* Fixed Back Button */
        .fixed-back-button {
            position: fixed;
            left: 20px;
            bottom: 20px;
            z-index: 1001;
            background: linear-gradient(45deg, var(--primary), var(--pink));
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 30px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .fixed-back-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
            background: linear-gradient(45deg, var(--pink), var(--primary));
        }

        /* Scroll to top button */
        .scroll-top-btn {
            position: fixed;
            bottom: 80px;
            right: 20px;
            background: var(--primary);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            z-index: 1000;
            transition: var(--transition);
        }

        .scroll-top-btn:hover {
            background: var(--pink);
            transform: translateY(-3px);
        }

        /* Footer Styles */
        footer {
            background-color: var(--gray);
            padding: 30px 0;
            margin-top: 50px;
            text-align: center;
        }

        .footer-content {
            max-width: 600px;
            margin: 0 auto;
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
        }

        .footer-links a {
            color: var(--light);
            text-decoration: none;
            transition: var(--transition);
        }

        .footer-links a:hover {
            color: var(--secondary);
        }

        .copyright {
            color: #aaa;
            font-size: 0.9rem;
        }

        /* Responsive Styles */
        @media (max-width: 768px) {
            .drama-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
                gap: 15px;
            }
            
            .drama-card {
                height: 280px;
                padding: 8px;
                gap: 12px;
            }
            
            .drama-image-container {
                height: 280px;
                width: 100px;
                min-width: 90px;
            }
            
            .center-controls {
                gap: 60px;
            }
            
            .skip-btn {
                width: 50px;
                height: 50px;
                font-size: 10px;
            }
            
            .skip-btn span {
                font-size: 20px;
            }
            
            .episode-button {
                padding: 15px 20px;
                font-size: 20px;
                min-height: 60px;
            }
            
            .episode-button.active {
                padding-left: 45px;
            }
            
            .episode-button.active::before {
                left: 15px;
                font-size: 16px;
            }
            
            .fixed-back-button {
                left: 10px;
                bottom: 10px;
                padding: 10px 18px;
                font-size: 13px;
            }
            
            :root {
                --player-fixed-height: 240px;
            }
        }

        @media (max-width: 480px) {
            .drama-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
            
            .drama-card {
                height: 210px;
                flex-direction: column;
                padding: 10px;
                text-align: center;
            }
            
            .drama-image-container {
                height: 100px;
                width: 100%;
                min-width: 100%;
                margin-bottom: 8px;
            }
            
            .center-controls {
                gap: 40px;
            }
            
            .skip-btn {
                width: 40px;
                height: 40px;
                font-size: 8px;
            }
            
            .skip-btn span {
                font-size: 16px;
            }
            
            .episode-button {
                padding: 12px 15px;
                font-size: 18px;
                min-height: 55px;
            }
            
            .episode-button.active {
                padding-left: 40px;
            }
            
            .episode-button.active::before {
                left: 12px;
                font-size: 14px;
            }
            
            .fixed-back-button {
                left: 5px;
                bottom: 5px;
                padding: 8px 15px;
                font-size: 12px;
            }
            
            :root {
                --player-fixed-height: 240px;
            }
        }

        @media (min-width: 768px) { 
            :root { 
                --player-fixed-height: 240px;
            }
        }

        @media (min-width: 1200px) {
            :root {
                --player-fixed-height: 500px;
            }
        }
    </style>
</head>
<body>

    <!-- MAIN CONTENT -->
    <main class="container">
        <div class="main-content">
            <!-- Player will be shown fixed at top -->
            <div id="playerContainer"></div>
            
            <!-- Drama info will be shown here -->
            <div id="dramaInfoContainer"></div>
            
            <!-- Episodes will be shown here -->
            <div id="episodesContainer"></div>
            
            <!-- Drama Grid (initial view) -->
            <div class="drama-grid" id="dramaGrid"></div>
        </div>
    </main>

    <!-- Fixed Back Button -->
    <button class="fixed-back-button" id="fixedBackButton" style="display: none;" onclick="goBackToDramas()">
        ‚Üê All Dramas
    </button>

    <!-- Scroll to Top Button -->
    <div class="scroll-top-btn" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">‚Üë</div>

    <!-- FOOTER -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-links">
                    <a href="#">About</a> 
                    <a href="#">Contact</a> 
                    <a href="#">Privacy Policy</a> 
                    <a href="#">Terms of Service</a>
                </div>
                <div class="copyright">¬© Powered By: Syed Muzammil Shah. All rights reserved.</div>
            </div>
        </div>
    </footer>

<script>
    // YouTube DRAMA DATA WITH PLAYLIST IDs
// YouTube DRAMA DATA WITH PLAYLIST IDs
const dramas = [
    {
        title: "KUFFARA",
        image: "https://i.ytimg.com/vi/OAzNGqVD8G8/hq720.jpg?sqp=-oaymwEXCK4FEIIDSFryq4qpAwkIARUAAIhCGAE=&rs=AOn4CLDEVodtYxVk28D9JSaQbrPt5m8uTg",
        playlistId: 'PLdZNFVCDo_1c2P8DYMqZRMclsvrjmiJYN',
        episodeCount: 90,
        category: "Romantic Drama",
        reverseOrder: false
    },
    {
        title: " ",
        image: " ",
        playlistId: ' ',
        episodeCount: 1,
        category: "Geo Tv Serial",
        reverseOrder: false
    },  
    {
        title: " ",
        image: " ",
        playlistId: ' ',
        episodeCount: 1,
        category: "Geo Tv Serial",
        reverseOrder: false
    }
];

// Global Variables
let player = null;
let currentDramaIndex = 0;
let currentUserEpisodeIndex = 0;
let hideTimeout;
let currentPlaylistId = '';
let youtubeAPILoaded = false;
let playerReady = false;
let currentPage = 'dramas'; // 'dramas' or 'episodes'
let currentDramaImage = '';

// Browser Back Button Handler
function setupBrowserBackButton() {
    window.addEventListener('popstate', function(event) {
        if (currentPage === 'episodes') {
            goBackToDramas();
        }
    });
    
    function pushHistoryState() {
        if (currentPage === 'episodes') {
            history.pushState({ page: 'episodes' }, '', '#episodes');
        } else {
            history.pushState({ page: 'dramas' }, '', '#');
        }
    }
    
    history.replaceState({ page: 'dramas' }, '', '#');
    return pushHistoryState;
}

// Function to render drama cards
function renderDramas(dramaList) {
    currentPage = 'dramas';
    const dramaGrid = document.getElementById('dramaGrid');
    dramaGrid.innerHTML = '';
    
    document.getElementById('playerContainer').innerHTML = '';
    document.getElementById('dramaInfoContainer').innerHTML = '';
    document.getElementById('episodesContainer').innerHTML = '';
    
    document.getElementById('fixedBackButton').style.display = 'none';
    dramaGrid.style.display = 'grid';
    document.body.classList.remove('player-open');
    
    if (player) {
        try {
            player.destroy();
            player = null;
        } catch (e) {
            console.log("Error destroying player:", e);
        }
    }
    
    dramaList.forEach((drama, index) => {
        const dramaCard = document.createElement('div');
        dramaCard.className = 'drama-card';
        dramaCard.id = `drama-${index}`;
        
        dramaCard.innerHTML = `
            <div class="drama-image-container">
                <img src="${drama.image}" alt="${drama.title}" class="drama-image">
                <div class="image-overlay">
                    <div class="watch-text">Watch ${drama.episodeCount} Episodes</div>
                </div>
            </div>
            <div class="drama-info">
                <div class="drama-title">${drama.title}</div>
                <div class="drama-year">${drama.category} ‚Ä¢ ${drama.episodeCount} Episodes</div>
            </div>
        `;
        
        dramaCard.onclick = () => {
            openDramaEpisodes(index);
        };
        
        dramaGrid.appendChild(dramaCard);
    });
    
    if (window.pushHistoryState) {
        window.pushHistoryState();
    }
}

// Function to open episodes for a specific drama with player
function openDramaEpisodes(dramaIndex) {
    currentPage = 'episodes';
    currentDramaIndex = dramaIndex;
    const drama = dramas[dramaIndex];
    currentPlaylistId = drama.playlistId;
    currentDramaImage = drama.image;
    
    document.getElementById('dramaGrid').style.display = 'none';
    document.getElementById('fixedBackButton').style.display = 'flex';
    document.body.classList.add('player-open');
    
    // Create player with drama image (centered from start)
    const playerContainer = document.getElementById('playerContainer');
    playerContainer.innerHTML = `
        <div class="player-box" id="playerBox" style="display: block;">
            <div class="player-content" id="playerArea" onclick="handleUIInteraction()">
                <!-- Drama Image in Player - CENTERED FROM START -->
                <img src="${drama.image}" alt="${drama.title}" 
                     class="drama-player-image centered" id="dramaPlayerImage">
                
                <div id="bufferingScreen">
                    <div class="neon-loader"></div>
                    <div class="loading-text">BUFFERING...</div>
                </div>
                <div class="center-controls">
                    <button class="skip-btn" onclick="skipWithLoading(-10); event.stopPropagation();">
                        <span>‚Ü∫</span>10s
                    </button>
                    <button class="skip-btn" onclick="skipWithLoading(10); event.stopPropagation();">
                        <span>‚Üª</span>10s
                    </button>
                </div>
                <div class="yt-iframe-wrapper" id="ytWrapper">
                    <div id="youtube-player"></div>
                </div>
                <div style="position:absolute; inset:0; z-index:5;" id="touchLayer"></div>
                <div class="bottom-ui" onclick="event.stopPropagation()">
                    <div class="p-bar" onclick="seek(event)">
                        <div class="p-fill" id="pFill"></div>
                    </div>
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <div style="display:flex; gap:15px; align-items:center;">
                            <button style="background:none; border:none; color:white; font-size:18px;" onclick="prevEp()">‚èÆ</button>
                            <button style="background:none; border:none; color:white; font-size:22px;" onclick="playPause()" id="playIcon">‚ñ∂</button>
                            <button style="background:none; border:none; color:white; font-size:18px;" onclick="nextEp()">‚è≠</button>
                            <span style="font-size:11px;"><span id="currTime">0:00</span> / <span id="totalTime">0:00</span></span>
                        </div>
                        <button style="background:none; border:none; color:white; font-size:18px;" onclick="toggleFullscreen()">‚õ∂</button>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    // Show drama info
    const dramaInfoContainer = document.getElementById('dramaInfoContainer');
    dramaInfoContainer.innerHTML = `
        <div class="drama-info-below">
            <h2>${drama.title}</h2>
            <p>${drama.category} ‚Ä¢ ${drama.episodeCount} Episodes</p>
        </div>
    `;
    
    // Create episodes buttons
    const episodesContainer = document.getElementById('episodesContainer');
    episodesContainer.innerHTML = `
        <div class="episodes-grid" id="episodesGrid"></div>
    `;
    
    const episodesGrid = document.getElementById('episodesGrid');
    for (let i = 0; i < drama.episodeCount; i++) {
        const episodeNumber = i + 1;
        const btn = document.createElement('button');
        btn.className = 'episode-button';
        btn.id = `ep-button-${i}`;
        btn.innerHTML = `Episode ${episodeNumber}`;
        btn.onclick = (e) => {
            e.stopPropagation();
            openPlayer(i);
        };
        episodesGrid.appendChild(btn);
    }
    
    setTimeout(() => {
        if (typeof YT !== 'undefined' && YT.Player) {
            initializePlayer();
        } else {
            if (!youtubeAPILoaded) {
                loadYouTubeAPI();
            }
        }
    }, 500);
    
    window.scrollTo({top: 0, behavior: 'smooth'});
    
    if (window.pushHistoryState) {
        window.pushHistoryState();
    }
}

// Load YouTube API
function loadYouTubeAPI() {
    if (window.YT && window.YT.Player) {
        youtubeAPILoaded = true;
        initializePlayer();
        return;
    }
    
    const tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    const firstScriptTag = document.getElementsByTagName('script')[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
    
    window.onYouTubeIframeAPIReady = function() {
        youtubeAPILoaded = true;
        initializePlayer();
    };
}

// Initialize YouTube Player
function initializePlayer() {
    if (player) {
        try {
            player.destroy();
        } catch (e) {
            console.log("Error destroying previous player:", e);
        }
    }
    
    if (!document.getElementById('youtube-player')) {
        console.log("YouTube player element not found");
        return;
    }
    
    try {
        player = new YT.Player('youtube-player', {
            height: '100%',
            width: '100%',
            playerVars: {
                'autoplay': 0, // Auto-play disabled initially
                'controls': 0,
                'disablekb': 1,
                'enablejsapi': 1,
                'fs': 1,
                'modestbranding': 1,
                'rel': 0,
                'playsinline': 1,
                'iv_load_policy': 3,
                'showinfo': 0,
                'cc_load_policy': 0,
                'hl': 'en',
                'widget_referrer': window.location.hostname,
                'origin': window.location.origin,
                'autohide': 1
            },
            events: {
                'onReady': onPlayerReady,
                'onStateChange': onPlayerStateChange,
                'onError': onPlayerError
            }
        });
        
        setInterval(updateProgress, 500);
        
    } catch (error) {
        console.log("Error initializing YouTube player:", error);
    }
}

function onPlayerReady(event) {
    console.log("Player is ready");
    playerReady = true;
    
    // Show drama image initially (already centered)
    const dramaImage = document.getElementById('dramaPlayerImage');
    if (dramaImage) {
        dramaImage.classList.remove('hidden');
    }
}

// Helper function to detect if ad is playing
function isAdPlaying() {
    if (!player || !player.getVideoData) return false;
    
    try {
        const videoData = player.getVideoData();
        const title = videoData.title || '';
        const author = videoData.author || '';
        const duration = player.getDuration ? player.getDuration() : 0;
        
        // Check common ad indicators
        if (title === '' || 
            title.toLowerCase().includes('advertisement') || 
            title.toLowerCase().includes('ad') ||
            title.toLowerCase().includes('advert') ||
            author.toLowerCase().includes('google') ||
            duration <= 90) { // Ads are usually short (90 seconds or less)
            return true;
        }
        
        return false;
    } catch (error) {
        console.log("Error checking ad status:", error);
        return false;
    }
}

// UPDATED: Ads ⁄ÜŸÑÿ™€í €Å€å poster €Åÿßÿ¶€å⁄à €ÅŸà ÿ¨ÿßÿ¶€í
function onPlayerStateChange(event) {
    const loader = document.getElementById('bufferingScreen');
    const playIcon = document.getElementById('playIcon');
    const ytWrapper = document.getElementById('ytWrapper');
    const dramaImage = document.getElementById('dramaPlayerImage');
    
    if (!loader || !playIcon || !ytWrapper) return;
    
    // YouTube Player States:
    // -1: UNSTARTED
    // 0: ENDED
    // 1: PLAYING (includes ads and video)
    // 2: PAUSED
    // 3: BUFFERING
    // 5: VIDEO_CUED
    
    // ÿ¨ÿ® ⁄©Ÿàÿ¶€å content ⁄ÜŸÑ ÿ±€Åÿß €ÅŸà (ads ya video)
    if (event.data === YT.PlayerState.PLAYING) {
        loader.style.display = 'none';
        ytWrapper.classList.add('active');
        playIcon.innerText = '||';
        
        // üî• IMPORTANT: Ads ⁄ÜŸÑŸÜ€í Ÿæÿ± poster €Åÿßÿ¶€å⁄à €ÅŸà ÿ¨ÿßÿ¶€í
        if (dramaImage && isAdPlaying()) {
            dramaImage.classList.add('hidden');
        }
        // Video ⁄ÜŸÑŸÜ€í Ÿæÿ± ÿ®⁄æ€å poster €Åÿßÿ¶€å⁄à €ÅŸà
        else if (dramaImage) {
            dramaImage.classList.add('hidden');
        }
    }
    // Buffer €ÅŸà ÿ±€Åÿß €ÅŸà
    else if (event.data === YT.PlayerState.BUFFERING) {
        // Ads buffer €ÅŸà ÿ±€Å€å €ÅŸà⁄∫ ÿ™Ÿà loader ŸÜ€Å ÿØ⁄©⁄æÿßÿ¶€å⁄∫
        if (isAdPlaying()) {
            loader.style.display = 'none';
            // Ads buffer €ÅŸà ÿ±€Å€å €ÅŸà⁄∫ ÿ™ÿ® ÿ®⁄æ€å poster €Åÿßÿ¶€å⁄à ÿ±€Å€í
            if (dramaImage) {
                dramaImage.classList.add('hidden');
            }
        } else {
            loader.style.display = 'flex';
        }
    }
    // ÿ®ÿßŸÇ€å ÿ™ŸÖÿßŸÖ ÿ≠ÿßŸÑÿ™Ÿà⁄∫ ŸÖ€å⁄∫
    else {
        loader.style.display = 'none';
        
        if (event.data === YT.PlayerState.PAUSED) {
            playIcon.innerText = '‚ñ∂';
            // Pause Ÿæÿ± poster ÿØŸàÿ®ÿßÿ±€Å ÿØ⁄©⁄æÿßÿ¶€å⁄∫
            if (dramaImage) {
                dramaImage.classList.remove('hidden');
            }
        }
        else if (event.data === YT.PlayerState.ENDED) {
            const drama = dramas[currentDramaIndex];
            if (currentUserEpisodeIndex < drama.episodeCount - 1) {
                setTimeout(() => {
                    openPlayer(currentUserEpisodeIndex + 1);
                }, 2000);
            }
            // Ended Ÿæÿ± poster ÿØ⁄©⁄æÿßÿ¶€å⁄∫
            if (dramaImage) {
                dramaImage.classList.remove('hidden');
            }
        }
        else if (event.data === YT.PlayerState.CUED || event.data === -1) {
            // CUED ya UNSTARTED Ÿæÿ± poster ÿØ⁄©⁄æÿßÿ¶€å⁄∫
            if (dramaImage) {
                dramaImage.classList.remove('hidden');
            }
        }
    }
}

function onPlayerError(event) {
    console.log("Player error:", event.data);
    const loader = document.getElementById('bufferingScreen');
    if (loader) {
        loader.style.display = 'none';
    }
    
    // Show drama image on error
    const dramaImage = document.getElementById('dramaPlayerImage');
    if (dramaImage) {
        dramaImage.classList.remove('hidden');
    }
}

// Function to go back to dramas list
function goBackToDramas() {
    if (player) {
        try {
            player.stopVideo();
            player.destroy();
        } catch (e) {
            console.log("Error destroying player:", e);
        }
        player = null;
    }
    
    renderDramas(dramas);
    
    if (window.pushHistoryState) {
        window.pushHistoryState();
    }
    
    window.scrollTo({top: 0, behavior: 'smooth'});
}

function openPlayer(userEpisodeIndex) {
    if (!player || !playerReady) {
        console.log("Player not initialized or not ready");
        return;
    }
    
    const drama = dramas[currentDramaIndex];
    currentUserEpisodeIndex = userEpisodeIndex;
    
    let youtubePlaylistIndex;
    if (drama.reverseOrder) {
        youtubePlaylistIndex = drama.episodeCount - 1 - userEpisodeIndex;
    } else {
        youtubePlaylistIndex = userEpisodeIndex;
    }
    
    document.querySelectorAll('.episode-button').forEach(el => el.classList.remove('active'));
    
    const episodeButton = document.getElementById(`ep-button-${userEpisodeIndex}`);
    if (episodeButton) {
        episodeButton.classList.add('active');
    }
    
    const bufferingScreen = document.getElementById('bufferingScreen');
    const dramaImage = document.getElementById('dramaPlayerImage');
    
    // Show centered drama image
    if (dramaImage) {
        dramaImage.classList.remove('hidden');
    }
    
    // Show loading for initial load
    if (bufferingScreen) {
        bufferingScreen.style.display = 'flex';
    }
    
    const ytWrapper = document.getElementById('ytWrapper');
    if (ytWrapper) {
        ytWrapper.classList.remove('active');
    }
    
    if (player && player.loadPlaylist) {
        try {
            player.loadPlaylist({ 
                list: currentPlaylistId, 
                listType: 'playlist', 
                index: youtubePlaylistIndex
            });
            
        } catch (error) {
            console.log("Error loading playlist:", error);
        }
    } else {
        console.log("Player loadPlaylist not available");
    }
    
    const playerArea = document.getElementById('playerArea');
    if (playerArea) {
        playerArea.classList.add('show-ui');
        playerArea.classList.remove('hide-controls');
        
        hideTimeout = setTimeout(() => {
            playerArea.classList.remove('show-ui');
            playerArea.classList.add('hide-controls');
        }, 3000);
    }
}

// Skip function with loading animation
function skipWithLoading(seconds) {
    const bufferingScreen = document.getElementById('bufferingScreen');
    if (bufferingScreen) {
        bufferingScreen.style.display = 'flex';
        
        // Hide loading after 1 second
        setTimeout(() => {
            if (bufferingScreen) {
                bufferingScreen.style.display = 'none';
            }
        }, 1000);
    }
    
    skip(seconds);
}

// Original skip function
function skip(seconds) {
    if (player && player.getCurrentTime) {
        try {
            let currentTime = player.getCurrentTime();
            player.seekTo(currentTime + seconds, true);
            resetHideTimer();
        } catch (error) {
            console.log("Error skipping:", error);
        }
    }
}

function handleUIInteraction() {
    const playerArea = document.getElementById('playerArea');
    if (!playerArea) return;
    
    clearTimeout(hideTimeout);
    
    if (playerArea.classList.contains('hide-controls') || 
        !playerArea.classList.contains('show-ui')) {
        playerArea.classList.remove('hide-controls');
        playerArea.classList.add('show-ui');
        
        hideTimeout = setTimeout(() => { 
            playerArea.classList.remove('show-ui');
            playerArea.classList.add('hide-controls');
        }, 3000);
    } else {
        playerArea.classList.remove('show-ui');
        playerArea.classList.add('hide-controls');
    }
}

function resetHideTimer() {
    const playerArea = document.getElementById('playerArea');
    if (!playerArea) return;
    
    clearTimeout(hideTimeout);
    
    playerArea.classList.remove('hide-controls');
    playerArea.classList.add('show-ui');
    
    hideTimeout = setTimeout(() => { 
        playerArea.classList.remove('show-ui');
        playerArea.classList.add('hide-controls');
    }, 3000);
}

function playPause() {
    if (player) {
        try {
            if (player.getPlayerState() === YT.PlayerState.PLAYING) {
                player.pauseVideo();
            } else {
                player.playVideo();
            }
            resetHideTimer();
        } catch (error) {
            console.log("Error play/pause:", error);
        }
    }
}

function updateProgress() {
    if (player && player.getCurrentTime && player.getDuration) {
        try {
            const curr = player.getCurrentTime();
            const dur = player.getDuration();
            const pFill = document.getElementById('pFill');
            const currTime = document.getElementById('currTime');
            const totalTime = document.getElementById('totalTime');
            
            if (dur > 0 && pFill && currTime && totalTime) {
                pFill.style.width = (curr/dur*100) + '%';
                currTime.innerText = formatTime(curr);
                totalTime.innerText = formatTime(dur);
            }
        } catch (error) {
            console.log("Error updating progress:", error);
        }
    }
}

function formatTime(seconds) {
    const minutes = Math.floor(seconds / 60);
    const secs = Math.floor(seconds % 60);
    return minutes + ":" + (secs < 10 ? '0' : '') + secs;
}

function seek(e) {
    if (player && player.getDuration) {
        try {
            const rect = e.currentTarget.getBoundingClientRect();
            const duration = player.getDuration();
            const seekTo = ((e.clientX - rect.left) / rect.width) * duration;
            player.seekTo(seekTo, true);
            resetHideTimer();
        } catch (error) {
            console.log("Error seeking:", error);
        }
    }
}

function nextEp() {
    const drama = dramas[currentDramaIndex];
    if (currentUserEpisodeIndex < drama.episodeCount - 1) {
        openPlayer(currentUserEpisodeIndex + 1);
    }
}

function prevEp() {
    if (currentUserEpisodeIndex > 0) {
        openPlayer(currentUserEpisodeIndex - 1);
    }
}

function toggleFullscreen() {
    const playerArea = document.getElementById('playerArea');
    if (playerArea) {
        if (!document.fullscreenElement) {
            playerArea.requestFullscreen().catch(err => {
                console.log(`Error attempting to enable fullscreen: ${err.message}`);
            });
        } else {
            document.exitFullscreen();
        }
        resetHideTimer();
    }
}

// Initialize the page
document.addEventListener('DOMContentLoaded', function() {
    window.pushHistoryState = setupBrowserBackButton();
    
    if (typeof cordova !== 'undefined') {
        document.addEventListener('backbutton', function() {
            if (currentPage === 'episodes') {
                goBackToDramas();
            } else {
                if (navigator.app) {
                    navigator.app.exitApp();
                }
            }
        }, false);
    }
    
    renderDramas(dramas);
    loadYouTubeAPI();
    
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && currentPage === 'episodes') {
            goBackToDramas();
        }
    });
});

// Prevent right-click context menu on images
document.addEventListener('contextmenu', function(e) {
    if (e.target.tagName === 'IMG') {
        e.preventDefault();
        return false;
    }
});

// Prevent drag and drop of images
document.addEventListener('dragstart', function(e) {
    if (e.target.tagName === 'IMG') {
        e.preventDefault();
        return false;
    }
});

// Additional: Touch back gesture
let touchStartX = 0;
let touchStartY = 0;

document.addEventListener('touchstart', function(e) {
    touchStartX = e.touches[0].clientX;
    touchStartY = e.touches[0].clientY;
}, false);

document.addEventListener('touchend', function(e) {
    const touchEndX = e.changedTouches[0].clientX;
    const touchEndY = e.changedTouches[0].clientY;
    const diffX = touchEndX - touchStartX;
    const diffY = touchEndY - touchStartY;
    
    if (Math.abs(diffY) < 50 && diffX > 100 && currentPage === 'episodes') {
        goBackToDramas();
    }
}, false);
</script>
</body>
</html>
